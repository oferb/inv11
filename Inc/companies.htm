<form class="form-horizontal" id="f421" name="f421" novalidate action="javascript:UpdateCompanyData()">
    <fieldset>
        <!-- subtitle -->
        <div class="alert alert-dismissible alert-info h-info container-fluid">
            <div class="row-fluid">
                <button type="button" class="btn btn-primary btn-xs pull-left"
                        data-ng-click="defCompany()"
                        data-ng-show="selectedCompany.Id!=null && isCompSelectedTab!=0">
                    ביטול בחירה
                </button>
                <h3 class="pull-right">{{selectedCompanyTitle()}}</h3>
            </div>
        </div>
        <!-- tabs panel -->
        <ul class="nav nav-tabs" id="compCardTabs">
            <li class="active">
                <a data-ng-href="#allCompanies" data-toggle="tab"
                   data-ng-click="setCompTabSelected(-1)">רשימת העסקים</a>
            </li>
            <!-- card tabs -->
            <li data-ng-repeat="t in cardCompTabs track by $index"
                data-ng-show="$index==0 || selection.compId!=0" data-ng-hide="isCompSelectedTab==0 || ($index>0 && selection.compId==0)">
                <a data-ng-href="#{{t.name}}" data-toggle="tab"
                   data-ng-show="selectedCompany.Id!=null"
                   data-ng-click="setCompTabSelected($index)">
                    <!--tabCompanyCardClick($event)-->
                    {{selection.compId==0 ? "פרטי עסק חדש" : t.title}}
                    <span class="badge b-red" data-ng-show="cmpValidatorErrors[$index]>0">{{cmpValidatorErrors[$index]}}</span>
                </a>
            </li>

            <!--<li class="active" data-ng-show="selection.compId==0">
            <a data-ng-href="#compGeneralNew" data-toggle="tab"
               data-ng-click="setCompTabSelected(3)">פרטי עסק חדש</a>
        </li>-->

            <li class="pull-left" data-ng-show="isChangedCompField(null)">
                <span class="label label-warning w-not-saved">לא שמור</span>
            </li>
        </ul>

        <div class="col-md-12 tab-content">
            <div class="tab-pane active in tm-row" id="allCompanies"> <!--fade-->
                <!-- search/filters panel -->
                <table style="width:100%">
                    <tr>
                        <td style="padding:0px">
                            <div class="row tm-panel well">
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <input type="text" class="form-control input-sm" placeholder="חפש" style="margin-left:0px;"
                                               data-ng-model="search.companyKey" data-ng-disabled="userCompaniesBac.length==0" />
                                        <div class="input-group-btn" data-ng-style="{'visibility': search.companyKey.trim()=='' ? 'hidden':'visible'}">
                                            <button type="button" class="btn btn-default btn-sm" title="בטל" data-ng-click="search.companyKey=''">
                                                <span class="glyphicon glyphicon-remove"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">

                                </div>
                                <div class="col-md-2"><div class="found-items"><span>סה'כ בתי עסק: </span>{{userCompanies.length}}</div></div>
                                <div class="col-md-2">
                                    <div class="input-group tm-float">
                                        <a href="#" class="btn btn-primary btn-sm" data-ng-click="openCompanyCard(0)">הוספת עסק חדש</a><!--selection.compId=0-->
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
                <!-- no results -->
                <table style="width:100%" data-ng-show="userCompanies.length==0">
                    <tr>
                        <td>
                            <div class="alert alert-warning tm-panel">
                                <p style="text-align:center">אין בתי עסק</p>
                            </div>
                        </td>
                    </tr>
                </table>
                <!-- table -->
                <div style="min-height:430px;">
                    <table class="table table-striped table-hover tm-grid" id="tbCompanies" data-ng-show="userCompanies.length>0">
                        <thead style="cursor: pointer;">
                            <tr>
                                <th><span data-ng-click="changeSorting(companySort,'Id')"><span data-ng-class="selectedCls(companySort,'Id')"></span><a href="#">מס</a></span></th>
                                <th><span data-ng-click="changeSorting(companySort,'Identificator')"><span data-ng-class="selectedCls(companySort,'Identificator')"></span><a href="#">עוסק מורשה/ חפ / ת.ז</a></span></th>
                                <th><span data-ng-click="changeSorting(companySort,'Name')"><span data-ng-class="selectedCls(companySort,'Name')"></span><a href="#">שם העסק</a></span></th>
                                <th><span data-ng-click="changeSorting(companySort,'Address')"><span data-ng-class="selectedCls(companySort,'Address')"></span><a href="#">כתובת</a></span></th>
                                <th><span data-ng-click="changeSorting(companySort,'Email')"><span data-ng-class="selectedCls(companySort,'Email')"></span><a href="#">אמייל</a></span></th>
                                <th><span data-ng-click="changeSorting(companySort,'Phone')"><span data-ng-class="selectedCls(companySort,'Phone')"></span><a href="#">טלפון</a></span></th>
                                <th style="width:22px;text-align:center" title="סטטוס של מספור">סטטוס</th>
                                <th style="width:22px;text-align:center" title="מחיקה">מ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-ng-repeat="p in userCompanies | orderBy:companySort.column:companySort.descending | limitTo: pageSize : paging[1].from">
                                <td>{{p.Id}}</td> <!--data-ng-class="{'info':selectedCompany.Id==p.Id}"-->
                                <td>{{p.Identificator}}</td>
                                <td><a href="#" data-ng-click="openCompanyCard(p.Id);">{{getShortStr(p.Name, 30)}}</a></td>
                                <td>{{p.Street}}, {{p.City}}, {{p.Country}}</td>
                                <td><a href="mailto:{{p.Email}}">{{p.Email}}</a></td>
                                <td>{{p.Phone}}</td>
                                <td>
                                    <span class="glyphicon glyphicon-star" style="color:green" data-ng-show="p.IsLocked"></span>
                                    <a href="#" data-ng-show="p.IsLocked==null || !p.IsLocked" title="יש לשמור את מספור המסמכים כדי להשתמש בחברה"
                                       data-ng-click="selection.compId=p.Id">
                                        <span class="glyphicon glyphicon-star-empty" style="color:red"></span>
                                    </a>
                                </td>
                                <td>
                                    <a href="#"
                                       data-mwl-confirm
                                       title="מחיקה"
                                       data-message="למחוק את העסק?"
                                       data-confirm-text="מחיקה"
                                       data-cancel-text="ביטול"
                                       data-placement="right"
                                       data-on-confirm="deleteCompany(p.Id)"
                                       data-confirm-button-type="danger"
                                       data-cancel-button-type="default">
                                        <span class="glyphicon glyphicon-remove"></span>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- paging -->
                <div data-ng-include="'Templates/paging.tmpl.htm'" onload="index=1"></div>
            </div>

            <!-- card pages -->
            <div data-ng-repeat="t in cardCompTabs | limitTo: (selection.compId==0 ? 1 : 10)" class="tab-pane" data-ng-attr-id="{{t.name}}"> <!--fade in-->
                <div class="form-group row" data-ng-repeat="x in compEditConfig.data | filter: {tab: selection.compId==0 ? undefined : t.name}"
                     data-ng-class="{'has-warning':isChangedCompField(x.param)}" data-ng-show="selection.compId!=0 || compRequiredFields(x)">
                    <label class="col-md-3 control-label">{{x.label}} <span title="שדה חובה" data-ng-if="selectedCompany.Id==0 && x.hasOwnProperty('rule')"
                                        class="glyphicon glyphicon-asterisk" style="color:red;font-size:10px"></span></label>
                    <div class="col-md-9">
                        <input type="{{x.type}}" class="form-control" placeholder="{{x.label}}"
                               data-ng-model="selectedCompany[x.param]" dir="{{x.dir}}" name="{{x.param}}" />
                    </div>
                </div>
                <!-- logo -->
                <div class="form-group row  par-buton" data-ng-show="t.name=='compGeneral' && selectedCompany.Id!=0">
                    <div style="display:none">
                        <input type="file" name="file" multiple="multiple" id="myFile" onchange="FileUpload(this.files[0])">
                    </div>
                    <label class="col-md-3 control-label" data-ng-show="hasLogo()">לוגו (קליק כדי לעדכן)</label>
                    <label class="col-md-3 control-label" data-ng-show="!hasLogo()">לוגו (קליק כדי להוסיף)</label>
                    <div class="col-md-9">
                        <div style="border: 1px solid #CCCCCC; border-radius: 4px; background: #DCEEF7; padding: 4px; margin: 4px 0;text-align:center;width:278px">
                            <img data-ng-src="{{srcLogo}}" id="imgLogo" style="max-width:260px;" onclick="$('#myFile').click()" />
                        </div>
                    </div>
                </div>
            </div>
           
             <!-- card buttons -->
            <div style="min-height:60px">
                <div class="col-md-offset-3 col-md-3" data-ng-show="isCompSelectedTab!=0">
                    <button type="submit" class="btn btn-primary btn-large" data-ng-click="submitted=true;" data-ng-disabled="!isChangedCompField(null)">
                        שמירה
                    </button><!--  data-ng-disabled="cmpValidatorErrorsSum()>0 || (selectedCompany.Id==0 && isNewCompFormNotFilled())" -->
                    <button type="button" class="btn btn-warning btn-large" data-ng-click="submitted=true;resetErrorCompanyForms()" data-ng-disabled="!isChangedCompField(null)">
                        איתחול
                    </button>
                </div>
                <div class="alert alert-warning col-md-3 pull-left but-height" data-ng-show="selectedCompany.Id==0 && isNewCompFormNotFilled() && cmpValidatorErrorsSum()==0 && isCompSelectedTab>0">
                    נא למלא את כל השדות הנדרשים
                </div>
                <div class="alert alert-danger col-md-3 pull-left but-height" data-ng-show="cmpValidatorErrorsSum()>0">
                    <span data-ng-show="cmpValidatorErrorsSum()==1">שדה 1 לא עבר וולידציה</span>
                    <span data-ng-show="cmpValidatorErrorsSum()>1">{{cmpValidatorErrorsSum()}} שדות לא עברו וולידציה</span>
                </div>
            </div>
        </div>
    </fieldset>
</form>
<script>

    $().ready(function () {
        // validation instructions
        scope.companyValidator = $("#f421").validate(compEditConfig.toValidation());
    })

</script>